# Phone Agent 智能版 v1.2.3 迭代日志
## 版本总览
Phone Agent 智能版从基础 CLI 版本逐步迭代为具备 GUI 交互、多 AI 协作、手机多方式连接与投屏、TTS 语音播报、多模态内容生成的综合智能代理工具，核心围绕 GLM 系列大模型做决策、phone_agent 执行操作的双 AI 核心架构，后续扩展多模态辅助 AI 及语音合成能力。

## 1.0 版本
### 1.0.0
- 官方基础版本，需在指定文件夹终端启动。

### 1.0.1
- 集成 `adb connect + 手机IP` 能力，支持直接通过 Python 启动程序；
- 新增快捷键操作功能。

### 1.0.2
- 引入 GLM-4 构建双 AI 协作系统：GLM-4 负责任务决策，phone_agent 负责执行；
- 实现核心能力：自由聊天、手机操作。

### 1.0.3
- 优化输出视觉体验：GLM-4 输出为金色、phone_agent 输出为绿色、最终聚合输出为蓝色。

### 1.0.4
- 优化双 AI 协作逻辑，GLM-4 可智能判断并分流 5 类任务：
  1. 自由聊天：仅 GLM-4 响应；
  2. 手机操作：仅 phone_agent 响应；
  3. 单次回复：phone_agent 提取聊天记录 → GLM-4 生成回复 → phone_agent 发送；
  4. 持续回复：单次回复基础上，循环提取记录、判断新消息、生成并发送回复；
  5. 复杂操作：GLM-4 直接将指令传达给 phone_agent 执行。

### 1.0.5
- 优化 phone_agent 提示词，新增消息判断准则（基于气泡颜色）；
- 新增 `conversation_history.json` 文件，用于构建对话上下文、记录操作日志。

### 1.0.6
- 调整消息归属判断规则：左侧头像 → 对方消息，右侧头像 → 我方消息。

### 1.0.7
- 优化 phone_agent 提示词，要求精准返回头像位置信息，提升消息判断准确性。

### 1.0.8
- 新增日志管理功能：支持查看、清空 `conversation_history.json` 日志。

### 1.0.9
- 新增重试机制：聊天记录提取失败时自动重新提取，提升稳定性。

## 1.1 版本
### 1.1.0
- 优化 GLM-4 提示词，使其可基于头像位置判断消息发送方。

### 1.1.1
- 调整消息判断优先级：头像位置为主，气泡颜色为辅。

### 1.1.2
- 修复消息归属误判问题（避免我方消息被识别为对方消息）；
- 新增消息相似度比对能力，强化判断准确性。

### 1.1.3
- 新增持久化记忆功能：
  - `forever.txt`：仅支持手动改写，系统仅读取；
  - 保留原有 `conversation_history.json` 记忆模块。

### 1.1.4
- 修复 openai 包版本更新后兼容性问题：
  1. 导入语句：`from openai import OpenAI` → `import openai`；
  2. 客户端初始化：`client=OpenAI` → `client=openai.OpenAI`。

### 1.1.5
- 优化正则表达式，支持跨行聊天记录提取（新增 3 类正则规则）。

### 1.1.6
- 升级手机连接方式：支持无线、USB 双模式；
- 模块拆分重构：所有核心模块迁移至 `yuntai` 目录。

### 1.1.7
- 新增并行版本，交互形式从 CLI 升级为 GUI（图形界面）。

### 1.1.8
- 集成 GPT-SoVITS 实现 TTS 语音播报能力；
- 新增独立 TTS 语音交互界面；
- 【环境配置注意事项】需在 GPT-SoVITS 根目录下手动创建「参考音频」文件夹，用于存放 TTS 语音合成所需的参考音频素材。

### 1.1.9
- 新增手机投屏功能，可视化展示手机操作过程。

## 1.2 版本
### 1.2.0
- 优化消息提取：`yuntai.rely_manger.py` 升级更高效的消息提取方法；
- 工程优化：补充详细注释，缓解线程竞争冲突；修复 `AttributeError`（为 `NullWriter` 类新增 `_process_tts_block` 方法）；
- 修复连接问题：针对 USB 调试扫描导致 scrcpy 连接混乱，可执行 `adb disconnect adb-AADM023705011567-kUOrAE._adb-tls-connect._tcp` 指令解决。

### 1.2.1
- 深度模块化重构：将 TTS、GUI 组件、业务逻辑拆分为独立模块，迁移至 `yun` 目录（不影响 `yuntai` 包调用）；
- 功能升级：复杂操作、基础操作均支持 GPT-SoVITS TTS 语音播报。

### 1.2.2
- 升级核心 AI 模型：引入 GLM-4.6v-flash 替代原有 GLM-4，支持文本、视频、图片、文件多模态分析；
- 【AI 配置注意事项】GLM-4.6v-flash 需严格按照智谱官方部署文档配置环境，确保多模态分析功能正常；
- 修复 adb 连接混乱问题（解决 1.2.0 版本遗留问题）。

### 1.2.3
- 新增双 AI 辅助系统：引入 cogview-3-flash（文生图）、cogvideox-flash（文生视频/图生视频/首尾帧生视频），功能集成至动态菜单栏；
- 【AI 配置注意事项】
  1. cogview-3-flash（文生图）需单独下载模型文件，并配置专属推理环境；
  2. cogvideox-flash（多模态视频生成）需单独下载模型文件，支持文生视频、图生视频、首尾帧生视频三类核心能力；
- 交互修复：修复「清空输出」按钮无响应 bug；
- 操作优化：图像生成、视频生成、TTS 合成、执行命令按钮绑定「回车」快捷键；
- 版本整合：合并版本号，统一标注为 1.2.3（原 3.3.9）；
- AI 架构总结：
  - 核心双 AI 协作系统：GLM-4.6v-flash、autoglm-phone；
  - 多模态双 AI 辅助系统：cogview-3-flash、cogvideox-flash。

## 全局注意事项
1. GPT-SoVITS 环境配置：
   - 需先克隆 GPT-SoVITS 仓库到本地指定目录，配置环境变量 `GPT_SOVITS_ROOT` 指向该目录；
   - 必须在 GPT-SoVITS 根目录下创建「参考音频」文件夹，否则 TTS 语音合成功能会因缺少素材目录报错；
2. AI 模型部署：
   - 所有新增 AI 模型（GLM-4.6v-flash、cogview-3-flash、cogvideox-flash）均通过API调用；
   - `yun` 目录存放 TTS、GUI 等核心业务模块，`yuntai` 目录保留原 phone_agent 执行模块，禁止随意修改目录结构；
3. 依赖兼容性：
   - openai 包版本更新后需注意导入语句和客户端初始化方式的兼容性调整；
   - 部署 SGLang/vLLM 时出现的 transformers 依赖冲突可忽略，不影响模型推理功能。